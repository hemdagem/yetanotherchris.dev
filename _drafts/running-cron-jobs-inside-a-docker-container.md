---
Published: 2016-09-09T00:00:00.000Z
title: Running cron jobs inside a Docker container
author: Chris S
layout: post
shortpost: true
tags:
  - docker
  - unix
  - .net-core
---


Probably the most basic use of a Docker image is to run it, and let it exist - like [HERE] docker run hello-world. If you want to do this on a regular schedule, you have several options but the cron one is narrowed down to running cron on the Docker host or in the container.&nbsp;

I wanted to run a dotnet core console app that parses Reddit posts and posts itself, inside a Docker container, every 30 minutes on set days of the week.

Running the Docker image as a daemon with cron running inside it makes it a lot easier to update the Docker image and also bring up on other machines.

There's quite a few gotchas to doing this however, which I discovered and spent hours Googling the answers for. Most of the answers were dredged from Github repositories which luckily Google managed to find the keywords for. This included:

* Cron doesn't run as an interactive shell - you don't get any environmental variables &nbsp;- a well known restriction but nobody seemed to know the answer. I found my solution in [this repository](https://github.com/draffensperger/postgres-s3-backup).
* I'm running a .NET Core console app. It writes a temp file to its folder on the filesystem, but you don't have permission to do this without CHMOD'ing the app directory.
* Cron inside a Docker container can't write to a cron.log so you end up having to map a volume. Without this you get the error "tail: unrecognized file system type 0x794c7630 for '/var/log/cron.log'". This makes the Docker image rely on the host volume for storage, but it's only a log file. The fix came [from here](https://github.com/bringnow/docker-letsencrypt-manager/commit/7a157dcd05ea8e745ec604734f6e7aa2e9e7b7cc).


Below is the Docker file and the scripts are with the Gist.

<script src="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32.js"></script>

<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-b03925b9c18fa42b22f168e7d17a7ca70ca50a4126cbfca9f91a1a8bc79b5905.css" />

<div id="gist39555965" class="gist"><div class="gist-file"><div class="gist-data"><div class="js-gist-file-update-container js-task-list-container file-box"><div id="file-cron_task-sh" class="file"><div itemprop="text" class="blob-wrapper data type-shell"><table class="highlight tab-size js-file-line-container" data-tab-size="8"><tbody><tr><td id="file-cron_task-sh-L1" class="blob-num js-line-number" data-line-number="1">&nbsp;</td><td id="file-cron_task-sh-LC1" class="blob-code blob-code-inner js-file-line">env - <span class="pl-s"><span class="pl-pds">`</span>cat /root/env.sh<span class="pl-pds">`</span></span> /bin/bash -c <span class="pl-smi">$1</span> <span class="pl-k">&gt;&gt;</span> /var/log/cron.log <span class="pl-k">2&gt;&amp;1</span></td></tr></tbody></table></div></div></div></div><div class="gist-meta"><a style="float:right" href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32/raw/aa9d86ad73bfb01047c3f7bd6db0083ef6ec3268/cron_task.sh">view raw</a> <a href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32#file-cron_task-sh">cron_task.sh</a> hosted with ❤ by <a href="https://github.com">GitHub</a></div></div><div class="gist-file"><div class="gist-data"><div class="js-gist-file-update-container js-task-list-container file-box"><div id="file-crontab" class="file"><div itemprop="text" class="blob-wrapper data type-text"><table class="highlight tab-size js-file-line-container" data-tab-size="8"><tbody><tr><td id="file-crontab-L1" class="blob-num js-line-number" data-line-number="1">&nbsp;</td><td id="file-crontab-LC1" class="blob-code blob-code-inner js-file-line"># Run every 30 minutes on Wednesday</td></tr><tr><td id="file-crontab-L2" class="blob-num js-line-number" data-line-number="2">&nbsp;</td><td id="file-crontab-LC2" class="blob-code blob-code-inner js-file-line">*/30 * * * 3 /root/cron_task.sh /root/run_app.sh</td></tr><tr><td id="file-crontab-L3" class="blob-num js-line-number" data-line-number="3">&nbsp;</td><td id="file-crontab-LC3" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-crontab-L4" class="blob-num js-line-number" data-line-number="4">&nbsp;</td><td id="file-crontab-LC4" class="blob-code blob-code-inner js-file-line"># cron needs an empty line at the end, leave this here.</td></tr></tbody></table></div></div></div></div><div class="gist-meta"><a style="float:right" href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32/raw/aa9d86ad73bfb01047c3f7bd6db0083ef6ec3268/crontab">view raw</a> <a href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32#file-crontab">crontab</a> hosted with ❤ by <a href="https://github.com">GitHub</a></div></div><div class="gist-file"><div class="gist-data"><div class="js-gist-file-update-container js-task-list-container file-box"><div id="file-docker-cron-job-example" class="file"><div itemprop="text" class="blob-wrapper data type-text"><table class="highlight tab-size js-file-line-container" data-tab-size="8"><tbody><tr><td id="file-docker-cron-job-example-L1" class="blob-num js-line-number" data-line-number="1">&nbsp;</td><td id="file-docker-cron-job-example-LC1" class="blob-code blob-code-inner js-file-line">FROM microsoft/dotnet</td></tr><tr><td id="file-docker-cron-job-example-L2" class="blob-num js-line-number" data-line-number="2">&nbsp;</td><td id="file-docker-cron-job-example-LC2" class="blob-code blob-code-inner js-file-line">MAINTAINER Chris</td></tr><tr><td id="file-docker-cron-job-example-L3" class="blob-num js-line-number" data-line-number="3">&nbsp;</td><td id="file-docker-cron-job-example-LC3" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-docker-cron-job-example-L4" class="blob-num js-line-number" data-line-number="4">&nbsp;</td><td id="file-docker-cron-job-example-LC4" class="blob-code blob-code-inner js-file-line"># Fix from:</td></tr><tr><td id="file-docker-cron-job-example-L5" class="blob-num js-line-number" data-line-number="5">&nbsp;</td><td id="file-docker-cron-job-example-LC5" class="blob-code blob-code-inner js-file-line"># https://github.com/bringnow/docker-letsencrypt-manager/commit/7a157dcd05ea8e745ec604734f6e7aa2e9e7b7cc</td></tr><tr><td id="file-docker-cron-job-example-L6" class="blob-num js-line-number" data-line-number="6">&nbsp;</td><td id="file-docker-cron-job-example-LC6" class="blob-code blob-code-inner js-file-line"># Put cron logfiles into a volume. This also works around bug</td></tr><tr><td id="file-docker-cron-job-example-L7" class="blob-num js-line-number" data-line-number="7">&nbsp;</td><td id="file-docker-cron-job-example-LC7" class="blob-code blob-code-inner js-file-line"># https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=810669</td></tr><tr><td id="file-docker-cron-job-example-L8" class="blob-num js-line-number" data-line-number="8">&nbsp;</td><td id="file-docker-cron-job-example-LC8" class="blob-code blob-code-inner js-file-line"># caused by base image using old version of coreutils</td></tr><tr><td id="file-docker-cron-job-example-L9" class="blob-num js-line-number" data-line-number="9">&nbsp;</td><td id="file-docker-cron-job-example-LC9" class="blob-code blob-code-inner js-file-line"># which causes "tail: unrecognized file system type 0x794c7630 for '/var/log/cron.log'"</td></tr><tr><td id="file-docker-cron-job-example-L10" class="blob-num js-line-number" data-line-number="10">&nbsp;</td><td id="file-docker-cron-job-example-LC10" class="blob-code blob-code-inner js-file-line"># when using docker with overlay storage driver.</td></tr><tr><td id="file-docker-cron-job-example-L11" class="blob-num js-line-number" data-line-number="11">&nbsp;</td><td id="file-docker-cron-job-example-LC11" class="blob-code blob-code-inner js-file-line">VOLUME /var/log/</td></tr><tr><td id="file-docker-cron-job-example-L12" class="blob-num js-line-number" data-line-number="12">&nbsp;</td><td id="file-docker-cron-job-example-LC12" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-docker-cron-job-example-L13" class="blob-num js-line-number" data-line-number="13">&nbsp;</td><td id="file-docker-cron-job-example-LC13" class="blob-code blob-code-inner js-file-line">RUN mkdir /app</td></tr><tr><td id="file-docker-cron-job-example-L14" class="blob-num js-line-number" data-line-number="14">&nbsp;</td><td id="file-docker-cron-job-example-LC14" class="blob-code blob-code-inner js-file-line">COPY ./src/MyApp/bin/Debug/netcoreapp1.0/publish /app</td></tr><tr><td id="file-docker-cron-job-example-L15" class="blob-num js-line-number" data-line-number="15">&nbsp;</td><td id="file-docker-cron-job-example-LC15" class="blob-code blob-code-inner js-file-line">WORKDIR /app</td></tr><tr><td id="file-docker-cron-job-example-L16" class="blob-num js-line-number" data-line-number="16">&nbsp;</td><td id="file-docker-cron-job-example-LC16" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-docker-cron-job-example-L17" class="blob-num js-line-number" data-line-number="17">&nbsp;</td><td id="file-docker-cron-job-example-LC17" class="blob-code blob-code-inner js-file-line">RUN apt-get update</td></tr><tr><td id="file-docker-cron-job-example-L18" class="blob-num js-line-number" data-line-number="18">&nbsp;</td><td id="file-docker-cron-job-example-LC18" class="blob-code blob-code-inner js-file-line">RUN apt-get install -y cron</td></tr><tr><td id="file-docker-cron-job-example-L19" class="blob-num js-line-number" data-line-number="19">&nbsp;</td><td id="file-docker-cron-job-example-LC19" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-docker-cron-job-example-L20" class="blob-num js-line-number" data-line-number="20">&nbsp;</td><td id="file-docker-cron-job-example-LC20" class="blob-code blob-code-inner js-file-line">ADD *.sh /root/</td></tr><tr><td id="file-docker-cron-job-example-L21" class="blob-num js-line-number" data-line-number="21">&nbsp;</td><td id="file-docker-cron-job-example-LC21" class="blob-code blob-code-inner js-file-line">RUN chmod 750 /root/cron_task.sh</td></tr><tr><td id="file-docker-cron-job-example-L22" class="blob-num js-line-number" data-line-number="22">&nbsp;</td><td id="file-docker-cron-job-example-LC22" class="blob-code blob-code-inner js-file-line">RUN chmod 750 /root/run_redditbot.sh</td></tr><tr><td id="file-docker-cron-job-example-L23" class="blob-num js-line-number" data-line-number="23">&nbsp;</td><td id="file-docker-cron-job-example-LC23" class="blob-code blob-code-inner js-file-line">RUN chmod 750 /app/</td></tr><tr><td id="file-docker-cron-job-example-L24" class="blob-num js-line-number" data-line-number="24">&nbsp;</td><td id="file-docker-cron-job-example-LC24" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-docker-cron-job-example-L25" class="blob-num js-line-number" data-line-number="25">&nbsp;</td><td id="file-docker-cron-job-example-LC25" class="blob-code blob-code-inner js-file-line">ADD crontab /var/spool/cron/crontabs/root</td></tr><tr><td id="file-docker-cron-job-example-L26" class="blob-num js-line-number" data-line-number="26">&nbsp;</td><td id="file-docker-cron-job-example-LC26" class="blob-code blob-code-inner js-file-line">RUN chmod 0600 /var/spool/cron/crontabs/root</td></tr><tr><td id="file-docker-cron-job-example-L27" class="blob-num js-line-number" data-line-number="27">&nbsp;</td><td id="file-docker-cron-job-example-LC27" class="blob-code blob-code-inner js-file-line">&nbsp;</td></tr><tr><td id="file-docker-cron-job-example-L28" class="blob-num js-line-number" data-line-number="28">&nbsp;</td><td id="file-docker-cron-job-example-LC28" class="blob-code blob-code-inner js-file-line">CMD touch /var/log/cron.log &amp;&amp; cron &amp;&amp; env &gt; /root/env.sh &amp;&amp; tail -f /var/log/cron.log</td></tr></tbody></table></div></div></div></div><div class="gist-meta"><a style="float:right" href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32/raw/aa9d86ad73bfb01047c3f7bd6db0083ef6ec3268/docker-cron-job-example">view raw</a> <a href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32#file-docker-cron-job-example">docker-cron-job-example</a> hosted with ❤ by <a href="https://github.com">GitHub</a></div></div><div class="gist-file"><div class="gist-data"><div class="js-gist-file-update-container js-task-list-container file-box"><div id="file-run_app-sh" class="file"><div itemprop="text" class="blob-wrapper data type-shell"><table class="highlight tab-size js-file-line-container" data-tab-size="8"><tbody><tr><td id="file-run_app-sh-L1" class="blob-num js-line-number" data-line-number="1">&nbsp;</td><td id="file-run_app-sh-LC1" class="blob-code blob-code-inner js-file-line">dotnet /app/MyApp.dll</td></tr></tbody></table></div></div></div></div><div class="gist-meta"><a style="float:right" href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32/raw/aa9d86ad73bfb01047c3f7bd6db0083ef6ec3268/run_app.sh">view raw</a> <a href="https://gist.github.com/yetanotherchris/e5185530eee16495a1432d3acf7f3e32#file-run_app-sh">run_app.sh</a> hosted with ❤ by <a href="https://github.com">GitHub</a></div></div></div>