{"data":{"site":{"siteMetadata":{"title":"Another Chris","author":"Chris Small"}},"markdownRemark":{"id":"a0e290b0-c1db-5553-b9a9-e50746807664","excerpt":"The  previous post  explained: Counting and arithmetic in base 2,8,10,16 (binary, octal and decimal,hexadecimal),  Sign magnitude 1/2s complement (how integers…","html":"<p>The <a href=\"/csharp/csharp-bit-manipulation-by-example-part-1/\">previous post</a> explained:</p>\n<ul>\n<li>Counting and arithmetic in base 2,8,10,16 (binary, octal and decimal,hexadecimal), </li>\n<li>Sign magnitude</li>\n<li>1/2s complement (how integers are stored) and floating point storage</li>\n<li>Least and most significant bits, Endian formats.</li>\n<li>The point of hex displays</li>\n</ul>\n<!--more-->\n<p>It’s probably worth reading if some of the above is unclear before going through the examples. The examples below have capitalised method names to make it clearer what is happening (i.e. the operations are in caps).</p>\n<p>The WL() method is just the <a href=\"http://www.sliver.com/dotnet/SnippetCompiler/\">Snippet Compiler’s</a> wrapper for Console.WriteLine</p>\n<h3>AND Operator: &#x26;</h3>\n<p>This it the operator you’ll use most often as it’s used for comparisons. It will give you the mask value, if the value your checking contains the mask. This is in comparison to the | (OR) operator, which gives you the value back rather than the mask. So OR checks if either value is true, whilst AND checks if both values are true.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void AND()\n{\n    // If the mask value is 1, and the value is 1, it sets it to 1\n    // If the mask value is 1, and the value is 0, it keeps that 0\n    // If the mask value is 0, the value is set to 0 regardless\n    // 42   = 0010 1010\n    // 36   = 0010 0100\n    //\n    // val  = 0010 0000 = 32\n    int val = 42 &amp; 36;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>OR Operator: |</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void OR()\n{\n    // If the mask value is 0, the original is returned\n    // If the mask value is 1, 1 is returned (i.e. true || false == true)\n    // 42   = 0010 1010\n    // 36   = 0010 0100\n    //\n    // val  = 0010 1110 = 46\n    int val = 42 | 36;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>XOR Operator: ^</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void XOR()\n{\n    // Sets the bit only if 1 of the values is true, not both\n    // 42   = 0010 1010\n    // 36   = 0010 0100\n    //\n    // val  = 0000 1110 = 14\n    int val = 42 ^ 36;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>OR Equals: |=</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void OREQUALS()\n{\n    // Shorthand or alternative syntax for the OR mask,\n    // saves doing &quot;val = val | 36&quot;.\n    int val = 42;\n    val |= 36;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>AND Equals: &#x26;=</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void ANDEQUALS()\n{\n    // Shorthand or alternative syntax for the AND mask\n    int val = 42;\n    val &amp;= 36;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>XOR Equals: ^=</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void XOREQUALS()\n{\n    // Shorthand or alternative syntax for the XOR mask\n    int val = 42;\n    val ^= 36;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>NOT Operator: ~</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void NOT()\n{\n    // 42   = 0000 0000 0010 1010\n    //\n    // Result:\n    // -43  = 1111 1111 1101 0101\n    //\n    // Inverts the bits of 42, see the other article\n    // of how this works with 2s complement (you basically\n    // invert the bits and add 1)\n    int val = 42;\n    val = ~42;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>Using the Flags() Attribute</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// The Flags attribute is used for parsing of the enum and its string representation,\n// and is not actually necessary for the bit operations\n[Flags]\nenum Rights\n{\n    None = 0,       // 0000 0000\n    ReadFile = 1,   // 0000 0001\n    ModifyFile = 2, // 0000 0010\n    WriteFile = 4,  // 0000 0100\n    ReadDir = 8,    // 0000 1000\n    All = ReadFile | ModifyFile | WriteFile | ReadDir\n}\n\nstatic void FLAGS()\n{\n    // Using OR - adding values\n    // rights  = 0000 0001 (ReadFile)\n    // a       = 0000 0010 (ModifyFile)\n    // b       = 0000 0100 (WriteFile)\n    // rights  = 0000 0111 = 7\n    Rights rights = Rights.ReadFile;\n    rights |= Rights.ModifyFile;\n    rights |= Rights.WriteFile;\n    WL(&quot;|= {0}&quot;,rights);\n    \n    // Using AND\n    // rights  = 0000 0111\n    // a       = 0000 0010 (ModifyFile)\n    // rights  = 0000 0010 = 2\n    rights &amp;= Rights.ModifyFile;\n    WL(&quot;&amp;= {0}&quot;,rights);\n    \n    // Using XOR - removing a single value\n    // rights  = 0000 0111\n    // a       = 0000 0010 (ModifyFile)\n    // rights  = 0000 0101 = 5\n    rights = InitRights();\n    rights ^= Rights.ModifyFile;\n    \n    WL(&quot;^= {0}&quot;,rights);\n    // Using ~ - removing multiple flags\n    // rights  = 0011 1111\n    // a       = 1111 1001 ~(ModifyFile | WriteFile)\n    rights = Rights.All;\n    rights &amp;= ~(Rights.ModifyFile | Rights.WriteFile);\n    WL(&quot;~ {0}&quot;,rights);\n    \n    // Testing if it contains a value\n    // rights  = 0000 0110\n    // test    = 0000 1000\n    // displays None\n    rights = Rights.WriteFile | Rights.ModifyFile;\n    Rights test = rights &amp; Rights.ReadDir;\n    WL(&quot;Contains Rights.ReadDir: {0}&quot;,test == Rights.ReadDir);\n    \n    // Testing if it contains value 1 or value 2\n    // rights  = 0000 1110\n    // test    = 0000 0000\n    // displays None\n    rights = InitRights();\n    if ((rights &amp; Rights.ReadFile) == Rights.ReadFile)\n    WL(&quot;If test: contains ReadFile&quot;);\n    if ((rights &amp; Rights.ModifyFile) == Rights.ModifyFile)\n    WL(&quot;If test: contains ModifyFile&quot;);\n}\n\nstatic Rights InitRights()\n{\n    return Rights.ReadFile | Rights.ModifyFile | Rights.WriteFile;\n}</code></pre></div>\n<h3>Left shifting: &#x3C;&#x3C;</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void SHIFTLEFT()\n{\n    // 42   = 0010 1010\n    // &lt;&lt; 2 = 1010 1000 = 168\n    int val = 42;\n    val = val &lt;&lt; 2;\n    WL(&quot;{0}&quot;,val);\n    \n    // Pushing beyond 8 bits\n    // 42   = 0000 0000 0010 1010\n    // &lt;&lt; 4 = 0000 0010 1010 0000 = 672 (512 + 128 + 32)\n    val = 42;\n    val = val &lt;&lt; 4;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>Right shifting: >></h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void SHIFTRIGHT()\n{\n    // 42   = 0010 1010\n    // &gt;&gt; 2 = 0000 1010 = 10)\n    int val = 42;\n    val = val &gt;&gt; 2;\n    WL(&quot;{0}&quot;,val);\n    \n    //  42   = 0010 1010\n    // inverted using 1s complement\n    //  -42  = 1101 0101\n    //  -42  = 1101 0110 (2s complement: add 1)\n    //  105  = 0110 1001\n    // -105  = 1001 0111\n    //  120,000 = 0000 0000 0000 0001 1101 0100 1100 0000\n    // -120,000 = 1111 1111 1111 1110 0010 1011 0011 1111 (1s)\n    //            1111 1111 1111 1110 0010 1011 0100 0000 (2s - added 1)\n    // 42      = 0010 1010\n    // -42     = 1101 0110\n    // -42 &gt;&gt; 2 = 0011 0101\n    // -42 &gt;&gt; 2 = 1111 0101 (it pads the zeros to the left with 1s)\n    val = -42;\n    val = val &gt;&gt; 2;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>Bit shifting with a negative number</h3>\n<p>The well written JavaRanch article below has 2 good examples of bit shifting with negative numbers. Here’s a practical example</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">static void NEGATIVESHIFT()\n{\n    // Using 256 as 42 doesn&#39;t have enough bits (it right shifts to 0)\n    //\n    // 256   = 0000 0001 0000 0000\n    // -6    = 0000 0000 1111 1010 With shifting, this is promoted to an int, using the last 5 bits\n    //       = 0000 0000 0001 1010 (2 + 8 + 16 = 26)\n    //       = 0000 0000 0000 0000 (Zero as its shifting 26 bits to the right)\n    int val = 256 &gt;&gt; -6;\n    WL(&quot;{0}&quot;,val);\n}</code></pre></div>\n<h3>Reference</h3>\n<ul>\n<li><a href=\"http://www.blackwasp.co.uk/CSharpLogicalBitwiseOps.aspx\">An alternative, good C# reference</a></li>\n<li><a href=\"http://www.javaranch.com/journal/200406/ScjpTipLine-BitShifting.html\">A very well written readable article (for Java but relevant), not dry wikiprose</a></li>\n<li><a href=\"http://en.wikipedia.org/wiki/Endian\">Wikipedia article on Endianess</a></li>\n<li><a href=\"http://stackoverflow.com/questions/791328/how-does-bitwise-complement-operator-works\">Stackoverflow question on bitwise shifting</a></li>\n</ul>","frontmatter":{"title":"C# Bit manipulation by example (part 2)","date":"February 02, 2011","description":"The second part of a two-part blog series looking at bit manipulation in C#."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2011-02-02-csharp-bit-manipulation-by-example-part-2/","previous":{"fields":{"slug":"/2011-01-27-a-ui-redesign-for-spruce/"},"frontmatter":{"title":"A UI redesign for Spruce"}},"next":{"fields":{"slug":"/2011-02-14-starting-on-spruces-irony-powered-search-parser/"},"frontmatter":{"title":"Starting on Spruce's irony-powered search parser"}}}}