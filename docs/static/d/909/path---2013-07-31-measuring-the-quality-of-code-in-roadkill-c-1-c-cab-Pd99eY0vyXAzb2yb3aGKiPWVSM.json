{"data":{"site":{"siteMetadata":{"title":"Another Chris","author":"Chris Small"}},"markdownRemark":{"id":"822b58a4-b9c8-513e-818f-3ce97e0287f5","excerpt":"One of the subjects I recently studied in my part time university course was how to measure a software system’s complexity, including quality measures for your…","html":"<p>One of the subjects I recently studied in my part time university course was how to measure a software system’s complexity, including quality measures for your code. These are statistical ways of measuring code or system complexity date back to before the SOLID principles became popular and with a little bit of insight give a fairly good marker of how complicated or clean your code is.</p>\n<p>With Roadkill almost 3 years old, I thought I’d give some of the metrics a try on the source. There’s basically two ways of measuring system complexity: before you start the project and after/during the project.</p>\n<!--more-->\n<p><strong>The “before you start the project way”</strong></p>\n<p>The lines of code and length of the project can be estimated before starting the project by using something known as function point analysis (FPA). For this you take the UML use-case and class diagrams you have beautifully crafted and extract an estimate of the lines of code required by measuring the inter dependencies.</p>\n<p><em>(There are also other more obvious ways of doing estimates such as estimating based on previous project experience, breaking the work into smaller chunks and estimating but those techniques don’t include KLOC.)</em></p>\n<p>Using the output from the FPA you can then extend the estimation further by incorporating another estimation method called COCOMO. This takes the estimated lines of code from your FPA, and based on the language you’re using produces an estimated number of man months.</p>\n<p>For Roadkill, this would obviously be a bit pointless though as I didn’t UML diagram the project (nor should anyone doing a personal OS project in my view) or produce any big upfront design, and doing it now would be a waste of time. So that leads to the second way of estimating the system complexity.</p>\n<p><strong>The “during or after the project way”</strong></p>\n<p>The commonest way to do this is through KLOC, or thousands of lines of code. <a href=\"http://www.ohloh.net/p/roadkillwiki\">OLOH</a> employs this technique to give a rough estimation of the size of each of its OS projects it lists. It is, however, quite a primitive way of doing things and doesn’t really give you any idea of how easy the project is to maintain, bug fix and add new features to in the future - arguably the holy grail of software development.</p>\n<p>A texhnique called Cyclomatic-complexity is one of better and more scientific ways of measuring the complexity of your code, and dates back to before I was born. Tom Mcabe introduced it in 1976 and the idea behind it is fairly simple: count the number of branches or decision points in your methods/functions to arrive at a figure representing the complexity. So an if statement would count as 1, a while loop 1 and so on.</p>\n<p>Object-oriented metrics also exist including DIT, CBO (coupling between objects), NOC (number of children) and probably the most useful LCOM (lack of cohesion in methods metric). LCOM is worked out by calculating the number of pairs of methods that both access a private member variable (call this A), and the number of pairs that don’t (B). You then arrive at a figure by just calculating B - A, which if it’s negative is a zero.</p>\n<p>Of course you have to use your judgement with these metrics as this SO answer points out - they are there to provide some indication of the code complexity rather than a set of hard rules (“convert this to a constant”).</p>\n<p><strong>NDepend</strong></p>\n<p>So how does Roadkill fair with all of these metrics? Originally I set out to count a sample of classes in the Roadkill.Core project and get some metrics including KLOC. Luckily as I finish writing this blog post NDepend provided me with a free licence for Roadkill as an OSS project freebie.</p>\n<p>As a lazy programmer (the good type) I’m a sucker for productivity tools so I set about getting graphed-up on the Roadkill source. NDepend includes all the during/end of project metrics I’ve listed <a href=\"http://www.ndepend.com/Metrics.aspx\">plus a whole host of its own</a> that are specialized ones for. NET.</p>\n<p>The LINQ statements I used for my stats were:</p>\n<p><div id=\"gist6125916\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-gistfile1-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-c \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-gistfile1-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-gistfile1-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> &lt;Name&gt;LCOM&lt;/Name&gt;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-gistfile1-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">from</span> <span class=\"pl-en\">t</span> <span class=\"pl-k\">in</span> <span class=\"pl-smi\">JustMyCode</span>.<span class=\"pl-smi\">Types</span> <span class=\"pl-k\">where</span> <span class=\"pl-smi\">t</span>.<span class=\"pl-smi\">LCOM</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-gistfile1-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-k\">orderby</span> <span class=\"pl-smi\">t</span>.<span class=\"pl-smi\">LCOM</span> <span class=\"pl-k\">descending</span> </td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-gistfile1-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-k\">select</span> <span class=\"pl-k\">new</span> { <span class=\"pl-smi\">t</span>, <span class=\"pl-smi\">t</span>.<span class=\"pl-smi\">LCOM</span> }</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-gistfile1-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-gistfile1-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> &lt;Name&gt;LOC&lt;/Name&gt;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-gistfile1-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">from</span> <span class=\"pl-en\">a</span> <span class=\"pl-k\">in</span> <span class=\"pl-smi\">JustMyCode</span>.<span class=\"pl-smi\">Assemblies</span> </td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-gistfile1-cs-LC8\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-k\">select</span> <span class=\"pl-k\">new</span> { <span class=\"pl-smi\">a</span>, <span class=\"pl-smi\">a</span>.<span class=\"pl-smi\">NbLinesOfCode</span>, <span class=\"pl-smi\">a</span>.<span class=\"pl-smi\">NbILInstructions</span> }</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-gistfile1-cs-LC9\" class=\"blob-code blob-code-inner js-file-line\"> </td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-gistfile1-cs-LC10\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-c\"><span class=\"pl-c\">//</span> &lt;Name&gt;Cyclomatic complexity&lt;/Name&gt;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-gistfile1-cs-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">from</span> <span class=\"pl-en\">m</span> <span class=\"pl-k\">in</span> <span class=\"pl-smi\">JustMyCode</span>.<span class=\"pl-smi\">Methods</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-gistfile1-cs-LC12\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-k\">where</span> <span class=\"pl-smi\">m</span>.<span class=\"pl-smi\">CyclomaticComplexity</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-gistfile1-cs-LC13\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-k\">orderby</span> <span class=\"pl-smi\">m</span>.<span class=\"pl-smi\">CyclomaticComplexity</span> <span class=\"pl-k\">descending</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-gistfile1-cs-LC14\" class=\"blob-code blob-code-inner js-file-line\"> <span class=\"pl-k\">select</span> <span class=\"pl-k\">new</span> { <span class=\"pl-smi\">m</span>, <span class=\"pl-smi\">m</span>.<span class=\"pl-smi\">ParentType</span>.<span class=\"pl-smi\">Name</span>, <span class=\"pl-smi\">m</span>.<span class=\"pl-smi\">CyclomaticComplexity</span> }</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/yetanotherchris/6125916/raw/f011cea70299feed364bca97c73fa403014cfe9f/gistfile1.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/yetanotherchris/6125916#file-gistfile1-cs\">gistfile1.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>First off <strong>KLOC:</strong></p>\n<p><a href=\"http://www.anotherchris.net/assets/2013/07/loc.png\"><img class=\"alignnone size-medium wp-image-1152\" alt=\"loc\" src=\"http://www.anotherchris.net/assets/2013/07/loc-300x68.png\" width=\"300\" height=\"68\"></a></p>\n<p>This demonstrates that I have as much test code as I do production code (minus the HTML views, Javascript, CSS) which would no doubt horrify older school purists and coders who don’t embrace TDD or unit testing. For me it feels like a good sign though - I know I have fairly complete test coverage for the project, with the main gaps coming from wiki markup parser, which I use a Microsoft OS project for and the logging and caching.</p>\n<p>Next up is <strong>Cyclomatic Complexity</strong> (I’m counting anything with over 3 decision points):</p>\n<p><a href=\"http://www.anotherchris.net/assets/2013/07/cyclic.png\"><img class=\"alignnone size-medium wp-image-1150\" alt=\"cyclic\" src=\"http://www.anotherchris.net/assets/2013/07/cyclic-300x278.png\" width=\"300\" height=\"278\"></a></p>\n<p>The results are actually mostly positive, the majority of problems come from the CreoleParser class which came from creoleparser.codeplex.com, with some adjustments added to it over time. I’m looking to replace this completely in version 2 with an ANTLR based approach.</p>\n<p>One surprise from the table is that the Dependency Injection container - essentially the root or entry point of the application - is missing. It’s the “smelliest” class in the project and contains reams of hard to read Structuremap configuration.</p>\n<p>Finally there are the <strong>LCOM</strong> results - everything with 1 or above. Back in version 1.4 this would been a lot different as the project was riddled with poorly designed singletons I’d used as a deliberate design decision to make an API that was easy to use. Unfortunately it made the source very un-testable and involved a huge refactor to constructor injection to get rid of it.</p>\n<p>Higher LCOM values can mean you are calling static methods variables on other classes but there are no classes with more than a 1 LCOM in version 1.8, which is nice:</p>\n<p><a href=\"http://www.anotherchris.net/assets/2013/07/lcom.png\"><img class=\"alignnone size-medium wp-image-1151\" alt=\"lcom\" src=\"http://www.anotherchris.net/assets/2013/07/lcom-300x241.png\" width=\"300\" height=\"241\"></a></p>\n<p>And in summary NDepend thinks the project is green, though a bit too close to unstable:</p>\n<p><a href=\"http://www.anotherchris.net/assets/2013/07/AbstractnessVSInstability.png\"><img class=\"alignnone size-medium wp-image-1149\" alt=\"AbstractnessVSInstability\" src=\"http://www.anotherchris.net/assets/2013/07/AbstractnessVSInstability-300x300.png\" width=\"300\" height=\"300\"></a></p>\n<p> </p>","frontmatter":{"title":"Measuring the quality of code in Roadkill","date":"July 31, 2013","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2013-07-31-measuring-the-quality-of-code-in-roadkill/","previous":{"fields":{"slug":"/2013-06-30-syncing-github-with-codeplex/"},"frontmatter":{"title":"Syncing Github with Codeplex"}},"next":{"fields":{"slug":"/2013-10-11-anti-xss-net-libraries-a-hole-in-the-framework/"},"frontmatter":{"title":"Anti-XSS .NET libraries in 2013"}}}}