{"data":{"site":{"siteMetadata":{"title":"Another Chris","author":"Chris Small"}},"markdownRemark":{"id":"e9e477b7-1527-5d47-9dd3-9e5829e7ec83","excerpt":"Part 1 Part 2 Part 3 BufferedStream This is intended to improve performance of (file) read/write operations by storing the bytes in memory as a cache. The…","html":"<ul>\n<li><a href=\"/net/inside-the-systemio-namespace-part-1\">Part 1</a></li>\n<li>Part 2</li>\n<li><a href=\"/net/inside-the-systemio-namespace-part-3\">Part 3</a></li>\n</ul>\n<h3>BufferedStream</h3>\n<p>This is intended to improve performance of (file) read/write operations by storing the bytes in memory as a cache. The BufferedStream is an example of the Decorator pattern. You wrap a stream inside a BufferedStream in order to benefit from its functionality.</p>\n<!--more-->\n<p>No new methods or properties can be found in BuffereredStream, however it overrides the Stream class’ methods/properties to implement its own cache.</p>\n<p>Whilst it’s recommended you use a BufferedStream for large files on disk, you can also just set a large buffer on your FileStream and the same benefit will be had. To quote a Microsoft developer who worked on the System.IO namespace:</p>\n<blockquote>\n<p>“..there is zero benefit from wrapping a BufferedStream around a FileStream. We copied BufferedStream’s buffering logic into FileStream about 4 years ago to encourage better default performance” </p>\n</blockquote>\n<p>When I was writing the file reading logic in Statmagic (an open source project for parsing web log files), my strategy was to use a large buffer and skip using the BufferedStream. I assumed that my application would be running on a server with 4gb+ of SDRAM, or a desktop machine where the size of RAM far exceeds the size of the log file. Of course running it on a mobile device would require a different approach. Many websites have 100mb or GB log files per day but from tests I ran, it tears through even 2gb log files. The default size of the buffer in Statmagic is 16mb, which I got after some experimentation and reading of this discussion. In tests, this runs fine in both the single threaded reads and the multi-threaded reads where more than 1 log file is read at the same time. The single-threaded reads run slightly faster on a SATA (raid0’d) hard drive, though I haven’t tried it on a server setup yet.</p>\n<h3>FileStream</h3>\n<p>As the name implies, this is for reading and writing files. Some of the FileStream’s functionality is available via the File class (which just uses a FileStream under the hood).</p>\n<pre>Stream stream;\nstream = new FileStream(\"file.txt\", FileMode.Open);\nstream = File.Open(\"file.txt\", FileMode.Open); // this infact simply uses the line above with either FileAccess.Write or FileAccess.ReadWrite,\nstream = File.OpenRead(\"file.txt\"); // equivalent to new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.Read);\n\n// Writing to a FileStream, or reading is dependent on the file type being read.\n// Basic text files can be read a number of ways, possibly the easiest is\nusing ( StreamReader sr = new StreamReader( File.OpenRead() )\n{\n\tstring contents = sr.ReadToEnd();\n}\n</pre>\n<h3>NetworkStream</h3>\n<p>NetworkStream is used for reading binary from a socket typically via UDP or TCP. I spent some of my spare time many years ago writing C# libraries to read UDP packets from game servers for Quake 3, Half Life, Unreal. The main project went the way of a lot OS projects and remained unfinished, however the main bulk of the UDP reading logic was complete. Unfortunately there is no NetworkStream implementation with the UdpClient class that I used, instead you are fed the packet data as a byte array.</p>\n<p>The code below is an example of doing a HTTP GET with a NetworkStream. There is of course easier ways of doing this with the WebClient class, but this demonstrates how you might use the NetworkStream class. Attempting to use the Random access methods such as Seek() with the NetworkStream class will throw a NotImplemented exception, as I mentioned above you never have the whole data to work with, so Seek’ing makes no sense.</p>\n<p><div id=\"gist4964062\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-gistfile1-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-c \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-gistfile1-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-gistfile1-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">string</span> <span class=\"pl-smi\">host</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>google.com<span class=\"pl-pds\">&quot;</span></span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-gistfile1-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">string</span> <span class=\"pl-smi\">page</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>/search?q=networkstream<span class=\"pl-pds\">&quot;</span></span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-gistfile1-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-gistfile1-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> This is the simplest way of getting a NetworkStream back. It can also be</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-gistfile1-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> done at a lower level using your own Socket class and the options you</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-gistfile1-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> require.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-gistfile1-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-en\">TcpClient</span> <span class=\"pl-smi\">tcp</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">TcpClient</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-gistfile1-cs-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">tcp</span>.<span class=\"pl-en\">Connect</span>(<span class=\"pl-smi\">host</span>, <span class=\"pl-c1\">80</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-gistfile1-cs-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-en\">NetworkStream</span> <span class=\"pl-smi\">stream</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">tcp</span>.<span class=\"pl-en\">GetStream</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-gistfile1-cs-LC10\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-gistfile1-cs-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Send a HTTP request</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-gistfile1-cs-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">byte</span>[] <span class=\"pl-smi\">data</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">Unicode</span>.<span class=\"pl-en\">GetBytes</span>(<span class=\"pl-smi\">string</span>.<span class=\"pl-en\">Format</span>(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>GET {0} HTTP/1.0{1}{1}<span class=\"pl-pds\">&quot;</span></span>, <span class=\"pl-smi\">page</span>, <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-cce\">\\r\\n</span><span class=\"pl-pds\">&quot;</span></span>));</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-gistfile1-cs-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">stream</span>.<span class=\"pl-en\">Write</span>(<span class=\"pl-smi\">data</span>, <span class=\"pl-c1\">0</span>, <span class=\"pl-smi\">data</span>.<span class=\"pl-smi\">Length</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-gistfile1-cs-LC14\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-gistfile1-cs-LC15\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Get the returned data in 1k chunks.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-gistfile1-cs-LC16\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">byte</span>[] <span class=\"pl-smi\">buffer</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">byte</span>[<span class=\"pl-c1\">1024</span>];</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-gistfile1-cs-LC17\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">int</span> <span class=\"pl-smi\">i</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">stream</span>.<span class=\"pl-en\">Read</span>(<span class=\"pl-smi\">buffer</span>, <span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">1024</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-gistfile1-cs-LC18\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-en\">StringBuilder</span> <span class=\"pl-smi\">builder</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">StringBuilder</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-gistfile1-cs-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">while</span> (<span class=\"pl-smi\">i</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-gistfile1-cs-LC20\" class=\"blob-code blob-code-inner js-file-line\">{</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-gistfile1-cs-LC21\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-smi\">builder</span>.<span class=\"pl-en\">Append</span>(<span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">Unicode</span>.<span class=\"pl-en\">GetString</span>(<span class=\"pl-smi\">buffer</span>));</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-gistfile1-cs-LC22\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-smi\">i</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">stream</span>.<span class=\"pl-en\">Read</span>(<span class=\"pl-smi\">buffer</span>, <span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">1024</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-gistfile1-cs-LC23\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-gistfile1-cs-LC24\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-gistfile1-cs-LC25\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Write out to a file. NB the server header will be contained in this file too.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-gistfile1-cs-LC26\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">using</span> (<span class=\"pl-en\">StreamWriter</span> <span class=\"pl-en\">writer</span> <span class=\"pl-k\">=</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">StreamWriter</span>(@&quot;<span class=\"pl-en\">c</span>:\\<span class=\"pl-en\">out</span>.<span class=\"pl-en\">html</span>&quot;))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-gistfile1-cs-LC27\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-en\">writer</span>.<span class=\"pl-en\">Write</span>(<span class=\"pl-en\">builder</span>.<span class=\"pl-en\">ToString</span>());</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/yetanotherchris/4964062/raw/da277706b83987e401afdf9d810d4461030c5158/gistfile1.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/yetanotherchris/4964062#file-gistfile1-cs\">gistfile1.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h3>MemoryStream</h3>\n<p>The MemoryStream class only adds one new method, WriteTo() which copies the contents of the stream to a new stream and a Capacity property which is the size of the stream in memory.</p>\n<p>MemoryStream always deals with a byte array, which means if you want to manipulate string data you’ll be working with the Encoding class (or possibly the Convert class too). Once you’ve create a MemoryStream you can’t change its capacity. One gotcha with the class is the Write() method.</p>\n<pre>Write(byte[] buffer,offset,length);\n</pre>\n<p>The offset parameter is actually the offset you want it to start from in your byte array, not the offset in the Stream.</p>\n<p>An aside about Encodings and Unicode in .NET<br>\nOne thing that can trip you up when reading character streams in .NET is using the wrong encoding to read byte representations of text. This really only happens if you are on a western computer using the default encoding or ascii. Below is some example code, some characters might appear as ‘?’ in your browser, use a Unicode text editor like Metapad to view the code in or the solution file.</p>\n<p><div id=\"gist4964045\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-gistfile1-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-c \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-gistfile1-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-gistfile1-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Ascii/Latin reference:</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-gistfile1-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> 97  - a</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-gistfile1-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> 98  - b</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-gistfile1-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> 100 - c</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-gistfile1-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> 101 - d</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-gistfile1-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> 63  - ?</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-gistfile1-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> ë   - 235</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-gistfile1-cs-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> &#39;?&#39; is from Gujarati (Gujarati in Unicode is from 0A80 - 0AFF). The symbol is U+0A86.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-gistfile1-cs-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> &#39;ë&#39; is from Windows 1252 which is a subset of ISO 8859-2 Latin Alphabet 2 (extended ascii to include accented symbols,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-gistfile1-cs-LC10\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> special letters and symbols ). Windows 1252 is a legacy codepage used by previous versions of Windows and isn&#39;t a Unicode standard.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-gistfile1-cs-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> However, it is implemented in Windows NT as 1 byte Unicode.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-gistfile1-cs-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> &#39;ë&#39; is Symbol #235.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-gistfile1-cs-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">string</span> <span class=\"pl-smi\">s</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>abcde?ë<span class=\"pl-pds\">&quot;</span></span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-gistfile1-cs-LC14\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-gistfile1-cs-LC15\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> This will try to translate the Gujarati symbol to ascii, fail and converts</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-gistfile1-cs-LC16\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> it to ascii character 63 (a question mark symbol &#39;?&#39;).</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-gistfile1-cs-LC17\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> It will do the same with &#39;ë&#39; as this isn&#39;t an ascii character.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-gistfile1-cs-LC18\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-gistfile1-cs-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Ascii is 8 bit/1 byte per character.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-gistfile1-cs-LC20\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">b</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">ASCII</span>.<span class=\"pl-en\">GetBytes</span>(<span class=\"pl-smi\">s</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-gistfile1-cs-LC21\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-gistfile1-cs-LC22\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Windows 1252 is Encoding.Default for most Western users. So this will sucessfully get the right</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-gistfile1-cs-LC23\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> number (235) for &#39;ë&#39;, however the Gujarati symbol will still fail.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-gistfile1-cs-LC24\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-gistfile1-cs-LC25\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Windows 1252 is 8 bit/1 byte per character.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-gistfile1-cs-LC26\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">b</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">Default</span>.<span class=\"pl-en\">GetBytes</span>(<span class=\"pl-smi\">s</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-gistfile1-cs-LC27\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-gistfile1-cs-LC28\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> UTF8 is the commonest Unicode encoding, and can encode any Unicode characters.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-gistfile1-cs-LC29\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> It uses 1 byte to represent ascii characters, but up to 4 for others.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-gistfile1-cs-LC30\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">b</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">UTF8</span>.<span class=\"pl-en\">GetBytes</span>(<span class=\"pl-smi\">s</span>); <span class=\"pl-c\"><span class=\"pl-c\">//</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-gistfile1-cs-LC31\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-gistfile1-cs-LC32\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> Now it&#39;s 16 bit/2 bytes per char and will pickup the Gujarati symbol correctly.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-gistfile1-cs-LC33\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> The byte array will now be 14 in length. This is because every character has a numerical</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-gistfile1-cs-LC34\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> 2 byte value (16 bit, 65536 possibilities). Index 10+11 in the array hold the value of 0A86</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-gistfile1-cs-LC35\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> [10] 134 (86).</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-gistfile1-cs-LC36\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> [11] 10 (0A)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-gistfile1-cs-LC37\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> (Little Endian format so LSB first).</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-gistfile1-cs-LC38\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-gistfile1-cs-LC39\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> UTF16 can go up to 4 bytes per character for symbols higher than U+FFFF.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-gistfile1-cs-LC40\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">b</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">Unicode</span>.<span class=\"pl-en\">GetBytes</span>(<span class=\"pl-smi\">s</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-gistfile1-cs-LC41\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-gistfile1-cs-LC42\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> UTF32 translate it to 4 bytes per character, so the array is 32 bytes now.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-gistfile1-cs-LC43\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">b</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Encoding</span>.<span class=\"pl-smi\">UTF32</span>.<span class=\"pl-en\">GetBytes</span>(<span class=\"pl-smi\">s</span>);</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/yetanotherchris/4964045/raw/4205dc0c710d1df09f277efa5a131056e1926595/gistfile1.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/yetanotherchris/4964045#file-gistfile1-cs\">gistfile1.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h3>GZipStream/DeflateStream</h3>\n<p>These were added in .NET 2 to the new System.IO.Compression namespace to provide compression and decompression, in particular with ZIP files. There are no helper readers or writers for the 2 classes, so common tasks like zipping a folder are quite cumbersome. The examples below don’t stray much from the MSDN documentation, I’ve chunked the functionality to make it a bit clearer and concise.</p>\n<p>NB The GZipStream doesn’t support adding files to an archive, as MSDN states: </p>\n<blockquote>\n<p>“…however, this class does not inherently provide functionality for adding files to or extracting files from .zip archives” </p>\n</blockquote>\n<p>The GZipStream is purely for compressing a stream of bytes, it’s not intended to act as a zipping library like the SharpZipLib. </p>\n<h3>Writing</h3>\n<p><div id=\"gist4964019\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-gistfile1-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-c \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-gistfile1-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-gistfile1-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">byte</span>[] <span class=\"pl-smi\">buffer</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-gistfile1-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">using</span> (<span class=\"pl-en\">FileStream</span> <span class=\"pl-en\">fileStream</span> <span class=\"pl-k\">=</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">FileStream</span>(@&quot;<span class=\"pl-en\">c</span>:\\<span class=\"pl-en\">out</span>.<span class=\"pl-en\">html</span>&quot;, <span class=\"pl-en\">FileMode</span>.<span class=\"pl-en\">Open</span>))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-gistfile1-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\">{</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-gistfile1-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-c\"><span class=\"pl-c\">//</span> Read the file&#39;s contents into a byte array</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-gistfile1-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-en\">buffer</span> <span class=\"pl-k\">=</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">byte</span>[<span class=\"pl-en\">fileStream</span>.<span class=\"pl-en\">Length</span>];</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-gistfile1-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-smi\">fileStream</span>.<span class=\"pl-en\">Read</span>(<span class=\"pl-smi\">buffer</span>, <span class=\"pl-c1\">0</span>, <span class=\"pl-smi\">buffer</span>.<span class=\"pl-smi\">Length</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-gistfile1-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-gistfile1-cs-LC8\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-gistfile1-cs-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">using</span> (<span class=\"pl-en\">MemoryStream</span> <span class=\"pl-en\">memoryStream</span> <span class=\"pl-k\">=</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">MemoryStream</span>())</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-gistfile1-cs-LC10\" class=\"blob-code blob-code-inner js-file-line\">{</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-gistfile1-cs-LC11\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-c\"><span class=\"pl-c\">//</span> The GZipStream uses the MemoryStream to write its compressed version</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-gistfile1-cs-LC12\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-c\"><span class=\"pl-c\">//</span> of the byte array.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-gistfile1-cs-LC13\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-en\">using</span> (<span class=\"pl-en\">GZipStream</span> <span class=\"pl-en\">gzipStream</span> <span class=\"pl-k\">=</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">GZipStream</span>(<span class=\"pl-en\">memoryStream</span>, <span class=\"pl-en\">CompressionMode</span>.<span class=\"pl-en\">Compress</span>, <span class=\"pl-en\">true</span>))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-gistfile1-cs-LC14\" class=\"blob-code blob-code-inner js-file-line\">\t{</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-gistfile1-cs-LC15\" class=\"blob-code blob-code-inner js-file-line\">\t\t<span class=\"pl-en\">gzipStream</span>.</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-gistfile1-cs-LC16\" class=\"blob-code blob-code-inner js-file-line\">\t\t<span class=\"pl-en\">gzipStream</span>.<span class=\"pl-en\">Write</span>(<span class=\"pl-en\">buffer</span>, 0, <span class=\"pl-en\">buffer</span>.<span class=\"pl-en\">Length</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-gistfile1-cs-LC17\" class=\"blob-code blob-code-inner js-file-line\">\t}</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-gistfile1-cs-LC18\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-c\"><span class=\"pl-c\">//</span> Write back to a file.</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-gistfile1-cs-LC19\" class=\"blob-code blob-code-inner js-file-line\">\t<span class=\"pl-k\">using</span> (<span class=\"pl-en\">FileStream</span> <span class=\"pl-en\">fileStreamOut</span> <span class=\"pl-k\">=</span> <span class=\"pl-en\">new</span> <span class=\"pl-en\">FileStream</span>(@&quot;<span class=\"pl-en\">c</span>:\\<span class=\"pl-en\">out</span>.<span class=\"pl-en\">zip</span>&quot;, <span class=\"pl-en\">FileMode</span>.<span class=\"pl-en\">Create</span>))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-gistfile1-cs-LC20\" class=\"blob-code blob-code-inner js-file-line\">\t\t<span class=\"pl-en\">memoryStream</span>.<span class=\"pl-en\">WriteTo</span>(<span class=\"pl-en\">fileStreamOut</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-gistfile1-cs-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-gistfile1-cs-LC21\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/yetanotherchris/4964019/raw/7bb2522683b623b698ce82d1fc931133abd6bf35/gistfile1.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/yetanotherchris/4964019#file-gistfile1-cs\">gistfile1.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>","frontmatter":{"title":"Inside The System.IO Namespace Part 2","date":"October 19, 2010","description":"The second in a series of posts looking at the System.IO namespace."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2010-10-19-inside-the-system-io-namespace-part-2/","previous":{"fields":{"slug":"/2010-10-18-how-to-restore-the-new-text-file-option-in-the-windows-context-menu/"},"frontmatter":{"title":"How to restore the new text file option in the windows context menu"}},"next":{"fields":{"slug":"/2010-10-26-inside-the-system-io-namespace-part-3/"},"frontmatter":{"title":"Inside The System.IO Namespace Part 3"}}}}